#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-push checks..."
echo ""

# Backend linting
echo "ğŸ§¹ Running backend linter..."
cd backend && npm run lint
if [ $? -ne 0 ]; then
  echo "âŒ Backend linting failed. Push aborted."
  exit 1
fi

# Backend unit tests
echo ""
echo "ğŸ§ª Running backend unit tests..."
npm test
if [ $? -ne 0 ]; then
  echo "âŒ Backend unit tests failed. Push aborted."
  exit 1
fi

# Backend integration tests
echo ""
echo "ğŸ”— Running backend integration tests..."
npm run test:integration
if [ $? -ne 0 ]; then
  echo "âŒ Backend integration tests failed. Push aborted."
  exit 1
fi

# Backend build
echo ""
echo "ğŸ—ï¸  Building backend..."
npm run build
if [ $? -ne 0 ]; then
  echo "âŒ Backend build failed. Push aborted."
  exit 1
fi

# Frontend linting
echo ""
echo "ğŸ§¹ Running frontend linter..."
cd ../frontend && npm run lint
if [ $? -ne 0 ]; then
  echo "âŒ Frontend linting failed. Push aborted."
  exit 1
fi

# Frontend tests
echo ""
echo "ğŸ§ª Running frontend tests..."
npm test
if [ $? -ne 0 ]; then
  echo "âŒ Frontend tests failed. Push aborted."
  exit 1
fi

# Frontend build
echo ""
echo "ğŸ—ï¸  Building frontend..."
npm run build
if [ $? -ne 0 ]; then
  echo "âŒ Frontend build failed. Push aborted."
  exit 1
fi

echo ""
echo "âœ… All checks passed. Pushing..."
