# Server Configuration
NODE_ENV=development
PORT=3001

# Azure Key Vault Configuration
AZURE_KEY_VAULT_NAME=kv-bcagent-dev
AZURE_TENANT_ID=your-azure-tenant-id
AZURE_CLIENT_ID=your-azure-client-id
AZURE_CLIENT_SECRET=your-azure-client-secret

# Database (Azure SQL - from Key Vault in production)
DATABASE_SERVER=sqlsrv-bcagent-dev.database.windows.net
DATABASE_NAME=sqldb-bcagent-dev
DATABASE_USER=sqladmin
DATABASE_PASSWORD=your-sql-password
# Alternative: Use connection string from Key Vault
# DATABASE_CONNECTION_STRING=<from Key Vault: SqlDb-ConnectionString>

# Redis Cache (from Key Vault in production)
REDIS_HOST=redis-bcagent-dev.redis.cache.windows.net
REDIS_PORT=6380
REDIS_PASSWORD=your-redis-password
# Alternative: Use connection string from Key Vault
# REDIS_CONNECTION_STRING=<from Key Vault: Redis-ConnectionString>

# Redis Cache - Integration/E2E Tests (Docker Local)
# Uses Docker Redis container for tests. Start with:
#   docker compose -f docker-compose.test.yml up -d
REDIS_TEST_HOST=localhost
REDIS_TEST_PORT=6399
REDIS_TEST_PASSWORD=
REDIS_TEST_TLS=false

# Anthropic Claude API
ANTHROPIC_API_KEY=<from Key Vault: Claude-ApiKey>
ANTHROPIC_MODEL=claude-3-5-sonnet-20241022

# Business Central API
BC_API_URL=https://api.businesscentral.dynamics.com/v2.0
BC_TENANT_ID=<from Key Vault: BC-TenantId>
BC_ENVIRONMENT=production

# JWT Authentication - DEPRECATED
# JWT has been replaced by Microsoft OAuth 2.0 with session-based authentication
# See migration guide: docs-old/05-deprecated/01-jwt-authentication.md
# DO NOT USE - Keep for backward compatibility only
JWT_SECRET=<DEPRECATED - DO NOT USE>
JWT_EXPIRES_IN=24h
JWT_REFRESH_EXPIRES_IN=7d

# Microsoft OAuth 2.0 Authentication (NEW - REQUIRED)
MICROSOFT_CLIENT_ID=<from Azure App Registration or Key Vault: Microsoft-ClientId>
MICROSOFT_CLIENT_SECRET=<from Azure App Registration or Key Vault: Microsoft-ClientSecret>
MICROSOFT_TENANT_ID=common
MICROSOFT_REDIRECT_URI=http://localhost:3002/api/auth/callback
MICROSOFT_SCOPES="openid profile email offline_access User.Read https://api.businesscentral.dynamics.com/Financials.ReadWrite.All"

# Encryption for BC tokens (per-user) (NEW - REQUIRED)
# Generate with: openssl rand -base64 32
ENCRYPTION_KEY=<from Key Vault: ENCRYPTION-KEY or generate locally>

# Session management (NEW - REQUIRED)
# Generate with: openssl rand -base64 32
SESSION_SECRET=<from Key Vault: SESSION-SECRET or generate locally>
SESSION_MAX_AGE=86400000

# Frontend URL (NEW)
FRONTEND_URL=http://localhost:3000

# CORS Configuration
CORS_ORIGIN=http://localhost:3000

# Logging Configuration
# Log level: trace, debug, info, warn, error, fatal
# Development: debug, Production: info or warn
LOG_LEVEL=debug
# Enable file logging (optional, useful for production)
ENABLE_FILE_LOGGING=false
LOG_FILE_PATH=./logs/app.log
ERROR_LOG_FILE_PATH=./logs/error.log
# Service filtering for diagnostics (comma-separated list)
# When set, only logs from these services will be shown
# Example: LOG_SERVICES=AgentOrchestrator,PersistenceCoordinator,ChatMessageHandler
# LOG_SERVICES=

# Session Configuration
SESSION_TIMEOUT_MINUTES=30

# Agent Configuration
MAX_CONTEXT_TOKENS=100000
ENABLE_PROMPT_CACHING=true
ENABLE_EXTENDED_THINKING=true

# Storage (Azure Blob Storage - from Key Vault in production)
STORAGE_CONNECTION_STRING=<from Key Vault: Storage-ConnectionString>
STORAGE_CONTAINER_NAME=user-files

# Azure Document Intelligence (OCR for Phase 3 Document Processing)
# Optional - if not configured, OCR features will be disabled
AZURE_DI_ENDPOINT=https://your-document-intelligence-resource.cognitiveservices.azure.com/
AZURE_DI_KEY=<from Key Vault: DocumentIntelligence-Key>

# Azure Computer Vision (Image Embeddings for Phase 3)
# Optional - if not configured, image embedding features will be disabled
# Resource: cv-bcagent-dev (S1 SKU)
AZURE_VISION_ENDPOINT=https://your-computer-vision-resource.cognitiveservices.azure.com/
AZURE_VISION_KEY=<from Key Vault: AZURE-VISION-KEY>

# Azure OpenAI (Embeddings)
# Required for semantic search and RAG functionality
AZURE_OPENAI_ENDPOINT=<from Key Vault: AZURE-OPENAI-ENDPOINT>
AZURE_OPENAI_KEY=<from Key Vault: AZURE-OPENAI-KEY>
AZURE_OPENAI_EMBEDDING_DEPLOYMENT=text-embedding-3-small

# Azure AI Search (Vector Store)
# Required for semantic search functionality
AZURE_SEARCH_ENDPOINT=<from Key Vault: AZURE-SEARCH-ENDPOINT>
AZURE_SEARCH_KEY=<from Key Vault: AZURE-SEARCH-KEY>
AZURE_SEARCH_INDEX_NAME=file-chunks-index

# BullMQ Configuration
# Connection timeout for BullMQ Redis connection (ms)
# Increase for high-latency Redis (Azure Basic tier)
BULLMQ_CONNECTION_TIMEOUT=30000

# Queue Name Prefix (Environment Isolation)
# IMPORTANT: Use this to isolate local development from Azure deployments
# When both local and Azure share the same Redis, jobs can be "stolen" by wrong worker
# Use 'local' for local development, leave empty for Azure/production
# Example queue names with prefix: local--file-processing, local--file-chunking
QUEUE_NAME_PREFIX=local

# Queue Configuration (Multi-tenant Rate Limiting)
# Maximum number of jobs a single session can queue per hour
QUEUE_MAX_JOBS_PER_SESSION=100
# Rate limit time window in seconds (3600 = 1 hour)
QUEUE_RATE_LIMIT_WINDOW_SECONDS=3600

# Worker Concurrency Configuration
# Reduce these values for Azure Redis Basic tier (256 connections limit)
# Production (Premium Redis): Use higher values for throughput
# Development/Testing (Basic Redis): Use lower values (3, 2, 3, 1, 1, 2, 2)
QUEUE_MESSAGE_CONCURRENCY=10
QUEUE_TOOL_CONCURRENCY=5
QUEUE_EVENT_CONCURRENCY=10
QUEUE_USAGE_CONCURRENCY=1
QUEUE_FILE_PROCESSING_CONCURRENCY=8
QUEUE_FILE_CHUNKING_CONCURRENCY=5
QUEUE_EMBEDDING_CONCURRENCY=5

# Max retry attempts for failed jobs
QUEUE_MAX_RETRY_ATTEMPTS=3
# Initial backoff delay for retries in milliseconds
QUEUE_RETRY_INITIAL_DELAY=1000
# Number of completed jobs to keep for debugging
QUEUE_KEEP_COMPLETED=100
# TTL for completed jobs in seconds (3600 = 1 hour)
QUEUE_COMPLETED_TTL=3600
# Number of failed jobs to keep for debugging
QUEUE_KEEP_FAILED=500
# TTL for failed jobs in seconds (86400 = 24 hours)
QUEUE_FAILED_TTL=86400

# GDPR Compliance Configuration
# Retention period for deletion audit logs (days)
# Set to 0 to keep indefinitely (recommended for compliance)
GDPR_AUDIT_LOG_RETENTION_DAYS=365
# Embedding cache TTL in Redis (days) - embeddings auto-expire after this period
GDPR_EMBEDDING_CACHE_TTL_DAYS=7
# Enable verbose GDPR audit logging
GDPR_VERBOSE_LOGGING=false
