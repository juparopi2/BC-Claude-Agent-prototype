{
  "$schema": "Claude API Event Structure Documentation",
  "version": "2025-12-17",
  "source": "Claude API Streaming (claude-sonnet-4-20250514)",
  "description": "Complete event structure reference extracted from real API responses",

  "eventTypes": {
    "message_start": {
      "description": "Initiates a new message with complete metadata. Includes the final, complete content structure even before streaming begins.",
      "timing": "First event in response stream",
      "example": {
        "type": "message_start",
        "message": {
          "model": "claude-sonnet-4-20250514",
          "id": "msg_01EaZkLgbCEBL76f826VjHZH",
          "type": "message",
          "role": "assistant",
          "content": [
            {
              "type": "thinking",
              "thinking": "This is a very straightforward math question. 2 + 2 = 4. This is basic arithmetic.",
              "signature": "EvoBCkYIChgCKkBwMTYnjwUqhd..."
            },
            {
              "type": "text",
              "text": "2 + 2 = 4"
            }
          ],
          "stop_reason": "end_turn",
          "stop_sequence": null,
          "usage": {
            "input_tokens": 43,
            "cache_creation_input_tokens": 0,
            "cache_read_input_tokens": 0,
            "cache_creation": {
              "ephemeral_5m_input_tokens": 0,
              "ephemeral_1h_input_tokens": 0
            },
            "output_tokens": 45,
            "service_tier": "standard"
          }
        }
      },
      "fields": {
        "type": "Always 'message_start'",
        "message.id": "Unique message ID (e.g., 'msg_01EaZkLgbCEBL76f826VjHZH')",
        "message.model": "Model identifier (e.g., 'claude-sonnet-4-20250514')",
        "message.type": "Always 'message'",
        "message.role": "Always 'assistant'",
        "message.content": "Array of complete content blocks (thinking, text, tool_use) - NOTE: Contains final content before streaming!",
        "message.stop_reason": "Completion reason ('end_turn', 'tool_use', etc.)",
        "message.stop_sequence": "Stop sequence if matched, otherwise null",
        "message.usage": "Token usage with caching breakdown and service tier"
      },
      "notes": [
        "Unlike typical streaming APIs, message_start contains the COMPLETE final content",
        "This is followed by granular streaming events that deliver the same content incrementally",
        "The thinking signature is cryptographically signed content for verification"
      ]
    },

    "content_block_start": {
      "description": "Begins a new content block of specific type (thinking, text, tool_use)",
      "timing": "Before streaming content for that block",
      "examples": {
        "thinking_block": {
          "type": "content_block_start",
          "index": 0,
          "content_block": {
            "type": "thinking",
            "thinking": "",
            "signature": ""
          }
        },
        "text_block": {
          "type": "content_block_start",
          "index": 1,
          "content_block": {
            "type": "text",
            "text": ""
          }
        },
        "tool_use_block": {
          "type": "content_block_start",
          "index": 1,
          "content_block": {
            "type": "tool_use",
            "id": "toolu_01Ao2QxVajRW868Yy9TFR33N",
            "name": "get_current_time",
            "input": {}
          }
        },
        "citations_block": {
          "type": "content_block_start",
          "index": 1,
          "content_block": {
            "citations": [],
            "type": "text",
            "text": ""
          }
        }
      },
      "fields": {
        "type": "Always 'content_block_start'",
        "index": "Zero-based index of this content block in the message",
        "content_block.type": "Block type: 'thinking', 'text', 'tool_use'",
        "content_block.thinking": "Empty string (populated in deltas) - for thinking blocks",
        "content_block.signature": "Empty string (populated in deltas) - for thinking blocks",
        "content_block.text": "Empty string (populated in deltas) - for text blocks",
        "content_block.citations": "Empty array (populated in deltas) - for text blocks with citations",
        "content_block.id": "Tool call ID - for tool_use blocks",
        "content_block.name": "Tool name - for tool_use blocks",
        "content_block.input": "Tool input (may be empty initially) - for tool_use blocks"
      },
      "notes": [
        "Index increments sequentially for each content block",
        "Content fields start empty and populate via content_block_delta events",
        "Citations appear as empty array initially, populated via citations_delta events"
      ]
    },

    "content_block_delta": {
      "description": "Streams incremental content for the current block",
      "timing": "Multiple times during content generation",
      "deltaTypes": {
        "thinking_delta": {
          "description": "Streams extended thinking content",
          "example": {
            "type": "content_block_delta",
            "index": 0,
            "delta": {
              "type": "thinking_delta",
              "thinking": "This is a very"
            }
          },
          "fields": {
            "delta.type": "Always 'thinking_delta'",
            "delta.thinking": "Incremental thinking text chunk"
          }
        },
        "text_delta": {
          "description": "Streams visible response text",
          "example": {
            "type": "content_block_delta",
            "index": 1,
            "delta": {
              "type": "text_delta",
              "text": "2 + 2 "
            }
          },
          "fields": {
            "delta.type": "Always 'text_delta'",
            "delta.text": "Incremental text chunk"
          }
        },
        "signature_delta": {
          "description": "Provides cryptographic signature for thinking block",
          "example": {
            "type": "content_block_delta",
            "index": 0,
            "delta": {
              "type": "signature_delta",
              "signature": "EvoBCkYIChgCKkBwMTYnjwUqhdDFfZHyYB1PYUXQiS6Gy..."
            }
          },
          "fields": {
            "delta.type": "Always 'signature_delta'",
            "delta.signature": "Base64-encoded cryptographic signature"
          },
          "notes": [
            "Always appears as the LAST delta for a thinking block",
            "Immediately followed by content_block_stop for that block"
          ]
        },
        "input_json_delta": {
          "description": "Streams tool input JSON (typically not user-visible)",
          "example": {
            "type": "content_block_delta",
            "index": 1,
            "delta": {
              "type": "input_json_delta",
              "partial_json": ""
            }
          },
          "fields": {
            "delta.type": "Always 'input_json_delta'",
            "delta.partial_json": "Partial JSON string for tool input"
          },
          "notes": [
            "Often empty for simple tool calls",
            "Not typically displayed to end users"
          ]
        },
        "citations_delta": {
          "description": "Provides source citations for RAG/document-based responses",
          "example": {
            "type": "content_block_delta",
            "index": 1,
            "delta": {
              "type": "citations_delta",
              "citation": {
                "type": "char_location",
                "cited_text": "## Key Features\n\n- Financial Management\n- Supply Chain Management...",
                "document_index": 0,
                "document_title": "Business Central Overview",
                "start_char_index": 277,
                "end_char_index": 498
              }
            }
          },
          "fields": {
            "delta.type": "Always 'citations_delta'",
            "delta.citation.type": "Citation type (e.g., 'char_location')",
            "delta.citation.cited_text": "Exact text cited from source document",
            "delta.citation.document_index": "Zero-based index of source document",
            "delta.citation.document_title": "Title of source document",
            "delta.citation.start_char_index": "Character position where citation starts",
            "delta.citation.end_char_index": "Character position where citation ends"
          },
          "notes": [
            "Appears BEFORE the text_delta that uses this citation",
            "Multiple citations can precede a single text block",
            "Enables source attribution for RAG systems"
          ]
        }
      },
      "fields": {
        "type": "Always 'content_block_delta'",
        "index": "Index of content block being updated",
        "delta": "Delta object with type-specific content"
      }
    },

    "content_block_stop": {
      "description": "Marks the end of a content block",
      "timing": "After all deltas for that block",
      "example": {
        "type": "content_block_stop",
        "index": 0
      },
      "fields": {
        "type": "Always 'content_block_stop'",
        "index": "Index of completed content block"
      },
      "notes": [
        "For thinking blocks, appears immediately after signature_delta",
        "Signals that no more deltas will come for this block index"
      ]
    },

    "message_delta": {
      "description": "Provides final message metadata (stop reason, usage)",
      "timing": "After all content_block_stop events, before message_stop",
      "example": {
        "type": "message_delta",
        "delta": {
          "stop_reason": "end_turn",
          "stop_sequence": null
        },
        "usage": {
          "input_tokens": 43,
          "cache_creation_input_tokens": 0,
          "cache_read_input_tokens": 0,
          "output_tokens": 45
        }
      },
      "fields": {
        "type": "Always 'message_delta'",
        "delta.stop_reason": "Reason for completion: 'end_turn', 'tool_use', 'max_tokens', etc.",
        "delta.stop_sequence": "Matched stop sequence or null",
        "usage.input_tokens": "Total input tokens consumed",
        "usage.cache_creation_input_tokens": "Tokens used for cache creation",
        "usage.cache_read_input_tokens": "Tokens read from cache",
        "usage.output_tokens": "Total output tokens generated"
      },
      "notes": [
        "Usage breakdown enables cost calculation",
        "Cached tokens are not billed in production",
        "stop_reason determines if another API turn is needed (e.g., tool_use requires tool result submission)"
      ]
    },

    "message_stop": {
      "description": "Signals the end of the streaming response",
      "timing": "Final event in the stream",
      "example": {
        "type": "message_stop"
      },
      "fields": {
        "type": "Always 'message_stop'"
      },
      "notes": [
        "No additional fields",
        "Indicates stream can be safely closed"
      ]
    }
  },

  "eventSequencePatterns": {
    "simple_response": {
      "description": "Basic text response without thinking or tools",
      "sequence": [
        "message_start",
        "content_block_start (text)",
        "content_block_delta (text_delta) [multiple]",
        "content_block_stop",
        "message_delta",
        "message_stop"
      ]
    },
    "thinking_response": {
      "description": "Response with extended thinking enabled",
      "sequence": [
        "message_start",
        "content_block_start (thinking)",
        "content_block_delta (thinking_delta) [multiple]",
        "content_block_delta (signature_delta)",
        "content_block_stop",
        "content_block_start (text)",
        "content_block_delta (text_delta) [multiple]",
        "content_block_stop",
        "message_delta",
        "message_stop"
      ]
    },
    "tool_use_response": {
      "description": "Response requesting tool execution",
      "sequence": [
        "message_start",
        "content_block_start (text)",
        "content_block_delta (text_delta) [multiple]",
        "content_block_stop",
        "content_block_start (tool_use)",
        "content_block_delta (input_json_delta)",
        "content_block_stop",
        "message_delta (stop_reason: 'tool_use')",
        "message_stop"
      ]
    },
    "citations_response": {
      "description": "Response with RAG citations",
      "sequence": [
        "message_start",
        "content_block_start (text - no citations)",
        "content_block_delta (text_delta) [multiple]",
        "content_block_stop",
        "content_block_start (text - with citations array)",
        "content_block_delta (citations_delta)",
        "content_block_delta (text_delta) [multiple]",
        "content_block_stop",
        "content_block_start (text - no citations)",
        "content_block_delta (text_delta) [multiple]",
        "content_block_stop",
        "message_delta",
        "message_stop"
      ],
      "notes": [
        "Citations create separate text blocks",
        "citations_delta appears BEFORE the text it cites",
        "Interleaves cited blocks with non-cited blocks"
      ]
    },
    "thinking_plus_tools_interleaved": {
      "description": "Complex response with both thinking and tool use",
      "sequence": [
        "message_start",
        "content_block_start (thinking)",
        "content_block_delta (thinking_delta) [multiple]",
        "content_block_delta (signature_delta)",
        "content_block_stop",
        "content_block_start (text)",
        "content_block_delta (text_delta) [multiple]",
        "content_block_stop",
        "content_block_start (tool_use)",
        "content_block_delta (input_json_delta)",
        "content_block_stop",
        "message_delta (stop_reason: 'tool_use')",
        "message_stop"
      ]
    }
  },

  "keyInsights": {
    "message_start_contains_final_content": "Unlike most streaming APIs, message_start includes the complete final message content. Subsequent events stream the same content incrementally.",

    "thinking_signatures": "Thinking blocks end with a cryptographic signature (signature_delta) for verification. This signature always appears last before content_block_stop.",

    "tool_use_creates_blocks": "Each tool call is a separate content block with type 'tool_use'. Input JSON may stream via input_json_delta but is often empty for simple calls.",

    "citations_create_separate_blocks": "Citations fragment text into multiple blocks. A citations_delta precedes the text_delta it applies to, creating citation-aware text segments.",

    "index_ordering": "content_block events use zero-based indexing that increments sequentially. This ordering is critical for reconstructing the message.",

    "usage_appears_twice": "Usage data appears in both message_start (final) and message_delta (streaming confirmation). Both contain identical values.",

    "stop_reason_determines_flow": "message_delta.stop_reason tells you if the conversation needs continuation: 'tool_use' requires tool result submission, 'end_turn' is final."
  }
}
