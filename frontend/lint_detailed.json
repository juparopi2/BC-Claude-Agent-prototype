[{"filePath":"D:\\Documents\\BC-Claude-Agent-prototype\\frontend\\__tests__\\components\\chat\\ChatInput.test.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":40,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1022,1025],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1022,1025],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { render, screen, fireEvent, waitFor } from '@testing-library/react';\r\nimport ChatInput from '@/components/chat/ChatInput';\r\nimport { getFileApiClient } from '@/lib/services/fileApi';\r\nimport { vi, describe, it, expect, beforeEach } from 'vitest';\r\n\r\n// Mock dependenciess\r\nvi.mock('@/lib/services/fileApi', () => ({\r\n  getFileApiClient: vi.fn(),\r\n}));\r\n\r\nvi.mock('@/lib/stores/socketMiddleware', () => ({\r\n  useSocket: vi.fn(() => ({\r\n    isConnected: true,\r\n    isReconnecting: false,\r\n    sendMessage: vi.fn(),\r\n    stopAgent: vi.fn(),\r\n  })),\r\n}));\r\n\r\nvi.mock('@/lib/stores/chatStore', () => ({\r\n  useChatStore: vi.fn((selector) => selector({\r\n    isAgentBusy: false,\r\n    streaming: { isStreaming: false },\r\n  })),\r\n}));\r\n\r\n// Mock Sonner toast\r\nvi.mock('sonner', () => ({\r\n  toast: {\r\n    error: vi.fn(),\r\n  },\r\n}));\r\n\r\ndescribe('ChatInput Attachments', () => {\r\n  const mockUploadFiles = vi.fn();\r\n  const mockSendMessage = vi.fn();\r\n\r\n  beforeEach(() => {\r\n    vi.clearAllMocks();\r\n    (getFileApiClient as any).mockReturnValue({\r\n      uploadFiles: mockUploadFiles,\r\n    });\r\n  });\r\n\r\n  it('uploads file and adds attachment chip on selection', async () => {\r\n    mockUploadFiles.mockResolvedValue({\r\n      success: true,\r\n      data: {\r\n        files: [{ id: 'file-123', name: 'test.pdf', size: 1024 }]\r\n      }\r\n    });\r\n\r\n    render(\r\n      <ChatInput \r\n        sessionId=\"session-1\" \r\n        isConnected={true} \r\n        sendMessage={mockSendMessage}\r\n      />\r\n    );\r\n\r\n    // Test is incomplete - skipping for now\r\n  });\r\n\r\n  it('handles file upload and sending correctly', async () => {\r\n     mockUploadFiles.mockImplementation((files, parent, onProgress) => {\r\n      onProgress(50);\r\n      return Promise.resolve({\r\n        success: true,\r\n        data: {\r\n          files: [{ id: 'file-uuid-1', name: 'test-doc.pdf', size: 2048 }]\r\n        }\r\n      });\r\n    });\r\n\r\n    const { container } = render(\r\n      <ChatInput \r\n        sessionId=\"session-1\" \r\n        isConnected={true} \r\n        sendMessage={mockSendMessage}\r\n      />\r\n    );\r\n\r\n    const file = new File(['dummy content'], 'test-doc.pdf', { type: 'application/pdf' });\r\n    const input = container.querySelector('input[type=\"file\"]') as HTMLInputElement;\r\n\r\n    expect(input).toBeInTheDocument();\r\n\r\n    // Trigger change event\r\n    fireEvent.change(input, { target: { files: [file] } });\r\n\r\n    // Expect upload to be called\r\n    await waitFor(() => {\r\n      expect(mockUploadFiles).toHaveBeenCalled();\r\n    });\r\n\r\n    // Check for chip existence\r\n    // It enters \"uploading\" state then \"completed\"\r\n    await waitFor(() => {\r\n      expect(screen.getByText('test-doc.pdf')).toBeInTheDocument();\r\n    });\r\n\r\n    // Type a message\r\n    const textarea = screen.getByRole('textbox');\r\n    fireEvent.change(textarea, { target: { value: 'Analyze this file' } });\r\n\r\n    // Click send\r\n    const sendButton = screen.getByTestId('send-button');\r\n    fireEvent.click(sendButton);\r\n\r\n    // Verify sendMessage call included attachment\r\n    expect(mockSendMessage).toHaveBeenCalledWith(\r\n      'Analyze this file',\r\n      expect.objectContaining({\r\n        attachments: ['file-uuid-1']\r\n      })\r\n    );\r\n  });\r\n});\r\n","usedDeprecatedRules":[]}]
